<div class="flex-1 min-h-0 bg-ui-bg-subtle overflow-auto p-6">
  <div class="mx-auto transition-all duration-300 ease-out bg-ui-bg-base shadow-lg rounded-lg overflow-hidden"
    [style.width]="deviceWidth" style="max-width: 100%; min-height: calc(100vh - 200px);">
    <div class="min-h-full">
      @if (sections.length === 0) {
      <div class="flex items-center justify-center h-96 text-ui-fg-muted">
        <div class="text-center">
          <p class="text-lg font-medium mb-2">{{ 'cms.preview.emptyTitle' | transloco }}</p>
          <p class="text-sm">{{ 'cms.preview.emptyDescription' | transloco }}</p>
        </div>
      </div>
      } @else {
      @for (section of sections; track section.id) {
      @if (section.visible) {
      <div class="relative transition-all" [class.ring-2]="isSelected(section) || hoveredId === section.id"
        [class.ring-inset]="isSelected(section) || hoveredId === section.id"
        [class.ring-ui-border-interactive]="isSelected(section)"
        [class.ring-ui-border-base]="!isSelected(section) && hoveredId === section.id"
        [class.ring-dashed]="!isSelected(section) && hoveredId === section.id" (mouseenter)="setHover(section.id)"
        (mouseleave)="setHover(null)" (click)="$event.stopPropagation(); selectNode.emit(section.id)"
        (keydown.enter)="selectNode.emit(section.id)"
        (keydown.space)="$event.preventDefault(); selectNode.emit(section.id)" role="button" tabindex="0">
        @if (isSelected(section) || hoveredId === section.id) {
        <div class="absolute top-2 left-2 z-10 px-2 py-1 text-xs font-medium rounded"
          [class.bg-ui-bg-interactive]="isSelected(section)" [class.text-ui-fg-on-color]="isSelected(section)"
          [class.bg-ui-bg-interactive/80]="!isSelected(section)" [class.text-ui-fg-on-color]="!isSelected(section)">
          {{ section.name }}
        </div>
        }

        @switch (section.type) {
        @case ('announcement-bar') {
        <div class="py-2 px-4 text-center text-sm"
          [style.backgroundColor]="section.settings['backgroundColor'] || '#6366F1'"
          [style.color]="section.settings['textColor'] || '#FFFFFF'">
          {{ section.settings['text'] || ('cms.preview.announcementText' | transloco) }}
        </div>
        }
        @case ('header') {
        <header class="bg-white border-b border-ui-border-base px-6 py-4">
          <div class="flex items-center justify-between max-w-6xl mx-auto">
            <div class="flex items-center gap-8">
              <span class="text-xl font-bold">{{ section.settings['logoText'] || ('cms.preview.logoText' | transloco) }}</span>
              <nav class="hidden md:flex items-center gap-6">
                @for (block of section.blocks; track block.id) {
                <span class="text-sm text-gray-600 hover:text-gray-900 cursor-pointer">
                  {{ block.settings['label'] }}
                </span>
                }
              </nav>
            </div>
            <div class="flex items-center gap-4">
              @if (section.settings['showSearch']) {
              <i-lucide [img]="Search" class="h-4 w-4 text-gray-600"></i-lucide>
              }
              @if (section.settings['showCart']) {
              <i-lucide [img]="ShoppingCart" class="h-4 w-4 text-gray-600"></i-lucide>
              }
              <i-lucide [img]="Menu" class="h-4 w-4 text-gray-600 md:hidden"></i-lucide>
            </div>
          </div>
        </header>
        }
        @case ('hero-banner') {
        <div
          class="relative text-white py-24 px-6 overflow-hidden"
          [class.bg-gradient-to-br]="!section.settings['image']"
          [class.from-indigo-600]="!section.settings['image']"
          [class.to-purple-700]="!section.settings['image']"
          [style.backgroundImage]="section.settings['image'] ? 'url(' + section.settings['image'] + ')' : null"
          [style.backgroundSize]="section.settings['image'] ? 'cover' : null"
          [style.backgroundPosition]="section.settings['image'] ? 'center' : null"
        >
          @if (section.settings['image']) {
          <div
            class="absolute inset-0"
            [style.backgroundColor]="'rgba(0, 0, 0, ' + (toNumber(section.settings['overlayOpacity'], 40) / 100) + ')'"
          ></div>
          }
          <div
            class="relative max-w-4xl mx-auto"
            [class.text-left]="section.settings['textAlign'] === 'left'"
            [class.text-center]="!section.settings['textAlign'] || section.settings['textAlign'] === 'center'"
            [class.text-right]="section.settings['textAlign'] === 'right'"
          >
            <h1 class="text-4xl md:text-5xl font-bold mb-4">
              {{ section.settings['heading'] || ('cms.preview.heroWelcome' | transloco) }}
            </h1>
            <p class="text-lg md:text-xl opacity-90 mb-8">
              {{ section.settings['subheading'] || ('cms.preview.heroSubheading' | transloco) }}
            </p>
            <button class="bg-white text-indigo-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
              {{ section.settings['buttonText'] || ('cms.preview.heroCta' | transloco) }}
            </button>
          </div>
        </div>
        }
        @case ('split-hero') {
        <div class="flex flex-col md:flex-row min-h-[400px]"
          [class.md:flex-row-reverse]="section.settings['imagePosition'] === 'right'">
          <div class="flex-1 bg-gray-100 relative overflow-hidden">
            @if (section.settings['image']) {
            <img
              [src]="$any(section.settings['image'])"
              alt=""
              loading="lazy"
              class="absolute inset-0 h-full w-full object-cover"
            />
            }
          </div>
          <div class="flex-1 flex items-center justify-center p-8 md:p-12">
            <div class="max-w-md">
              <h2 class="text-3xl font-bold mb-4">{{ section.settings['heading'] || ('cms.preview.splitHeroHeading' | transloco) }}</h2>
              <p class="text-gray-600 mb-6">{{ section.settings['description'] || ('cms.preview.splitHeroDescription' | transloco) }}</p>
              <button class="bg-gray-900 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-800 transition">
                {{ section.settings['buttonText'] || ('cms.preview.splitHeroCta' | transloco) }}
              </button>
            </div>
          </div>
        </div>
        }
        @case ('featured-collection') {
        <div class="py-16 px-6 bg-white">
          <div class="max-w-6xl mx-auto">
            <div class="flex items-center justify-between mb-8">
              <h2 class="text-2xl font-bold">{{ section.settings['heading'] || ('cms.preview.featuredHeading' | transloco) }}</h2>
              @if (section.settings['showViewAll']) {
              <button class="text-sm text-indigo-600 hover:text-indigo-700 flex items-center gap-1">
                {{ 'cms.preview.viewAll' | transloco }}
                <i-lucide [img]="ChevronRight" class="h-4 w-4"></i-lucide>
              </button>
              }
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
              @for (i of range(toNumber(section.settings['productsToShow'], 4)); track i) {
              <div class="group">
                <div class="aspect-square bg-gray-100 rounded-lg mb-3 group-hover:bg-gray-200 transition"></div>
                <h3 class="font-medium text-sm mb-1">{{ 'cms.preview.productName' | transloco }}</h3>
                <p class="text-sm text-gray-600">$99.00</p>
              </div>
              }
            </div>
          </div>
        </div>
        }
        @case ('collection-tabs') {
        <div class="py-16 px-6 bg-gray-50">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold text-center mb-8">{{ section.settings['heading'] || ('cms.preview.shopByCategory' | transloco) }}</h2>
            <div class="flex justify-center gap-4 mb-8">
              @for (block of section.blocks; track block.id; let i = $index) {
              <button class="px-4 py-2 rounded-full text-sm font-medium transition" [class.bg-gray-900]="i === 0"
                [class.text-white]="i === 0" [class.bg-white]="i !== 0" [class.text-gray-600]="i !== 0"
                [class.hover:bg-gray-100]="i !== 0">
                {{ block.name }}
              </button>
              }
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
              @for (_ of [1,2,3,4]; track $index) {
              <div class="group">
                <div class="aspect-square bg-white rounded-lg mb-3 shadow-sm group-hover:shadow-md transition"></div>
                <h3 class="font-medium text-sm mb-1">{{ 'cms.preview.productItem' | transloco: { index: $index + 1 } }}</h3>
                <p class="text-sm text-gray-600">$79.00</p>
              </div>
              }
            </div>
          </div>
        </div>
        }
        @case ('highlight-cards') {
        <div class="py-16 px-6 bg-white">
          <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-bold text-center mb-12">{{ section.settings['heading'] || ('cms.preview.whyChooseUs' | transloco) }}</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              @for (block of section.blocks.length ? section.blocks : [{ id: '1', name: 'cms.preview.highlight.freeShipping', settings: {
              icon: 'truck', description: 'cms.preview.highlight.freeShippingDescription' } }, { id: '2', name: 'cms.preview.highlight.easyReturns', settings: { icon:
              'refresh', description: 'cms.preview.highlight.easyReturnsDescription' } }, { id: '3', name: 'cms.preview.highlight.securePayment', settings: { icon:
              'shield', description: 'cms.preview.highlight.securePaymentDescription' } }]; track block.id; let i = $index) {
              <div class="text-center">
                <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mx-auto mb-4">
                  @if (i % 3 === 0) {
                    <i-lucide [img]="Truck" class="h-5 w-5 text-indigo-600"></i-lucide>
                  } @else if (i % 3 === 1) {
                    <i-lucide [img]="RefreshCw" class="h-5 w-5 text-indigo-600"></i-lucide>
                  } @else {
                    <i-lucide [img]="Shield" class="h-5 w-5 text-indigo-600"></i-lucide>
                  }
                </div>
                <h3 class="font-semibold mb-2">{{ block.name | transloco }}</h3>
                <p class="text-sm text-gray-600">{{ ($any(block.settings['description']) || '') | transloco }}</p>
              </div>
              }
            </div>
          </div>
        </div>
        }
        @case ('testimonials') {
        <div class="py-16 px-6 bg-gray-50">
          <div class="max-w-4xl mx-auto">
            <h2 class="text-2xl font-bold text-center mb-12">{{ section.settings['heading'] || ('cms.preview.testimonialsHeading' | transloco)
              }}</h2>
            <div class="bg-white rounded-2xl p-8 shadow-sm">
              <div class="flex gap-1 mb-4">
                @for (_ of [1,2,3,4,5]; track $index) {
                <i-lucide [img]="Star" class="h-4 w-4 text-yellow-400 fill-current"></i-lucide>
                }
              </div>
              <p class="text-lg text-gray-700 mb-6">{{ 'cms.preview.testimonialQuote' | transloco }}</p>
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gray-200"></div>
                <div>
                  <p class="font-medium">{{ 'cms.preview.testimonialName' | transloco }}</p>
                  <p class="text-sm text-gray-600">{{ 'cms.preview.testimonialRole' | transloco }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        }
        @case ('newsletter') {
        <div class="py-16 px-6" [style.backgroundColor]="section.settings['backgroundColor'] || '#F8FAFC'">
          <div class="max-w-xl mx-auto text-center">
            <i-lucide [img]="Mail" class="h-8 w-8 text-indigo-600 mb-4 mx-auto"></i-lucide>
            <h2 class="text-2xl font-bold mb-2">{{ section.settings['heading'] || ('cms.preview.newsletterHeading' | transloco) }}</h2>
            <p class="text-gray-600 mb-6">{{ section.settings['subheading'] || ('cms.preview.newsletterSubheading' | transloco) }}</p>
            <div class="flex gap-2 max-w-md mx-auto">
              <input type="email" [placeholder]="'cms.preview.newsletterEmailPlaceholder' | transloco"
                class="flex-1 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              <button class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-indigo-700 transition">
                {{ section.settings['buttonText'] || ('cms.preview.newsletterCta' | transloco) }}
              </button>
            </div>
          </div>
        </div>
        }
        @case ('footer') {
        <footer class="bg-gray-900 text-white py-12 px-6">
          <div class="max-w-6xl mx-auto">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-8">
              <div>
                <h3 class="font-semibold mb-4">{{ 'cms.preview.footer.quickLinks' | transloco }}</h3>
                <ul class="space-y-2 text-sm text-gray-400">
                  <li>{{ 'cms.preview.footer.shopAll' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.newArrivals' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.bestSellers' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.sale' | transloco }}</li>
                </ul>
              </div>
              <div>
                <h3 class="font-semibold mb-4">{{ 'cms.preview.footer.customerService' | transloco }}</h3>
                <ul class="space-y-2 text-sm text-gray-400">
                  <li>{{ 'cms.preview.footer.contactUs' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.shippingInfo' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.returns' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.faq' | transloco }}</li>
                </ul>
              </div>
              <div>
                <h3 class="font-semibold mb-4">{{ 'cms.preview.footer.company' | transloco }}</h3>
                <ul class="space-y-2 text-sm text-gray-400">
                  <li>{{ 'cms.preview.footer.aboutUs' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.careers' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.press' | transloco }}</li>
                  <li>{{ 'cms.preview.footer.blog' | transloco }}</li>
                </ul>
              </div>
              <div>
                <h3 class="font-semibold mb-4">{{ 'cms.preview.footer.followUs' | transloco }}</h3>
                @if (section.settings['showSocialLinks']) {
                <div class="flex gap-4">
                  <i-lucide
                    [img]="Facebook"
                    class="h-4 w-4 text-gray-400 hover:text-white cursor-pointer"
                  ></i-lucide>
                  <i-lucide
                    [img]="Twitter"
                    class="h-4 w-4 text-gray-400 hover:text-white cursor-pointer"
                  ></i-lucide>
                  <i-lucide
                    [img]="Instagram"
                    class="h-4 w-4 text-gray-400 hover:text-white cursor-pointer"
                  ></i-lucide>
                </div>
                }
              </div>
            </div>
            <div class="border-t border-gray-800 pt-8 text-center text-sm text-gray-400">
              {{ section.settings['copyrightText'] || ('cms.preview.footer.copyright' | transloco) }}
            </div>
          </div>
        </footer>
        }
        @default {
        <div class="py-12 px-6 bg-gray-100 text-center text-gray-500">
          {{ 'cms.preview.unknownSection' | transloco: { type: section.type } }}
        </div>
        }
        }
      </div>
      }
      }
      }
    </div>
  </div>
</div>

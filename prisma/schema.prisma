generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  USER
}

model User {
  id                 String          @id @default(uuid())
  email              String          @unique
  passwordHash       String
  firstName          String
  lastName           String
  avatar             String?
  role               Role            @default(USER)
  isActive           Boolean         @default(true)
  lastLoginAt        DateTime?
  refreshTokens      RefreshToken[]
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
}

model RefreshToken {
  id              String    @id @default(uuid())
  jti             String    @unique
  hashedToken     String
  userId          String
  createdAt       DateTime  @default(now())
  expiresAt       DateTime
  revokedAt       DateTime?
  reasonRevoked   String?
  replacedByToken String?
  createdByIp     String?
  revokedByIp     String?
  userAgent       String?
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([jti])
  @@index([expiresAt])
}
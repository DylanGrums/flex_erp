<aside class="flex flex-1 flex-col justify-between">
  <div class="flex flex-1 flex-col">
    <div class="sticky top-0">
      <div class="w-full">
        <div class="p-3">
          <button
            type="button"
            class="bg-ui-bg-subtle cursor-pointer transition-fg grid w-full grid-cols-[24px_1fr_15px] items-center gap-x-3 rounded-md p-0.5 pe-2 outline-none hover:bg-ui-bg-subtle-hover data-[state=open]:bg-ui-bg-subtle-hover focus-visible:shadow-borders-focus"
            [flexDropdownMenuTrigger]="storeMenu"
          >
            <div
              class="flex shrink-0 items-center justify-center overflow-hidden shadow-borders-base bg-ui-bg-base h-6 w-6 rounded-md"
            >
              <span
                class="flex shrink-0 items-center justify-center overflow-hidden shadow-borders-base bg-ui-bg-base h-6 w-6 rounded-md"
                ><span
                  class="aspect-square object-cover object-center txt-compact-xsmall-plus size-5 rounded bg-ui-bg-component-hover text-ui-fg-subtle pointer-events-none flex select-none items-center justify-center"
                >
                  <i-lucide [img]="Store" class="h-4 w-4"></i-lucide>
                </span>
              </span>
            </div>
            <div class="block overflow-hidden text-start">
              <div class="font-medium font-sans txt-compact-small truncate">
                {{ storeLabel() }}
              </div>
            </div>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="15"
              height="15"
              fill="none"
              class="text-ui-fg-muted"
            >
              <path
                fill="currentColor"
                fill-rule="evenodd"
                d="M6.306 7.5a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M1.194 7.5a1.194 1.194 0 1 1 2.39 0 1.194 1.194 0 0 1-2.39 0M11.417 7.5a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0"
                clip-rule="evenodd"
              ></path>
            </svg>
          </button>

          <!-- Dropdown content -->
          <ng-template #storeMenu>
            <div
              flexDropdownMenuContent
              class="box-border w-[196px] max-w-[196px] rounded-md border border-ui-border-base bg-ui-bg-base p-1 shadow-sm"
            >

              <div class="pb-2 pt-1 text-xs font-medium text-ui-fg-subtle">
                Switch store
              </div>

              <button
                *ngFor="let store of stores()"
                type="button"
                flexDropdownMenuItem
                class="flex w-full items-center gap-x-2 rounded-md py-2 text-start hover:bg-ui-bg-subtle-hover"
                (click)="selectStore(store.id)"
              >
                <div
                  class="flex h-7 w-7 items-center justify-center rounded-md bg-ui-bg-subtle"
                >
                  <i-lucide
                    [img]="Store"
                    class="h-4 w-4 text-ui-fg-subtle"
                  ></i-lucide>
                </div>

                <div class="flex min-w-0 flex-1 flex-col">
                  <span class="truncate text-sm font-medium">{{
                    store.name
                  }}</span>
                  <span class="truncate text-xs text-ui-fg-subtle">{{
                    store.id
                  }}</span>
                </div>

                <span *ngIf="storeId() === store.id" class="text-ui-fg-subtle">
                  <i-lucide [img]="Check" class="h-3 w-3"></i-lucide>
                </span>
              </button>

              <div class="my-1 h-px bg-ui-border-base"></div>

              <button
                type="button"
                flexDropdownMenuItem
                class="flex w-full items-center gap-x-2 rounded-md py-2 text-start hover:bg-ui-bg-subtle-hover"
                (click)="selectStore(null)"
              >
                <i-lucide
                  [img]="CircleX"
                  class="h-4 w-4 text-ui-fg-subtle"
                ></i-lucide>
                <span class="text-sm">Clear selection</span>
              </button>

              <div class="my-2 h-px bg-ui-border-base"></div>

              <button
                type="button"
                flexDropdownMenuItem
                class="flex w-full items-center gap-x-2 rounded-md py-2 text-start hover:bg-ui-bg-subtle-hover"
                [routerLink]="'/settings/store'"
              >
                <i-lucide
                  [img]="Store"
                  class="h-4 w-4 text-ui-fg-subtle"
                ></i-lucide>
                <span class="text-sm">{{
                  'nav.storeSettings' | transloco
                }}</span>
              </button>

              <div class="my-2 h-px bg-ui-border-base"></div>

              <button
                type="button"
                flexDropdownMenuItem
                class="flex w-full items-center gap-x-2 rounded-md py-2 text-start hover:bg-ui-bg-subtle-hover"
                [routerLink]="'/login'"
              >
                <i-lucide
                  [img]="LogOut"
                  class="h-4 w-4 text-ui-fg-subtle"
                ></i-lucide>
                <span class="text-sm">{{ 'common.logout' | transloco }}</span>
              </button>
            </div>
          </ng-template>
        </div>
      </div>

      <div class="px-3">
        <fe-divider variant="dashed" />
      </div>
    </div>

    <div class="flex flex-1 flex-col justify-between">
      <div class="flex flex-1 flex-col overflow-y-auto">
        <ng-container *ngFor="let section of coreSections(); let last = last">
          <div class="py-3">
            <div class="px-3">
              <div
                class="text-ui-fg-muted flex h-7 items-center justify-between px-2"
              >
                <span class="text-sm">{{ section.label | transloco }}</span>
              </div>
            </div>

            <div class="pt-0.5">
              <nav class="flex flex-col gap-y-0.5">
                <ng-container *ngFor="let route of section.items">
                  <app-nav-item
                    [item]="route"
                    [shortcuts]="shortcuts.shortcuts"
                  ></app-nav-item>
                </ng-container>
              </nav>
            </div>
          </div>

          <div class="px-3" *ngIf="section.dividerAfter ?? !last">
            <fe-divider variant="dashed" />
          </div>
        </ng-container>
      </div>

      <div class="flex flex-col gap-y-0.5 py-3">
        <app-nav-item
          [item]="{
            icon: Settings,
            label: 'nav.settings',
            to: '/settings',
            type: 'core',
          }"
          [shortcuts]="shortcuts.shortcuts"
        ></app-nav-item>
      </div>
    </div>

    <div class="bg-ui-bg-subtle sticky bottom-0">
      <div class="px-3">
        <fe-divider variant="dashed" />
      </div>
      <app-user-menu></app-user-menu>
    </div>
  </div>
</aside>

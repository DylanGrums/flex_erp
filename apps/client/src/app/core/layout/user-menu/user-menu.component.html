<div class="p-3">
  <p-popover  #menuPanel [styleClass]="'min-w-[220px] max-w-[220px]'">
    <div class="flex items-center gap-x-3 overflow-hidden px-2 py-1">
      <div
        class="flex h-8 w-8 items-center justify-center rounded-full bg-ui-bg-base"
      >
        <span class="text-xs font-semibold">{{ fallback() }}</span>
      </div>
      <div
        class="block w-full min-w-0 max-w-[187px] overflow-hidden whitespace-nowrap"
      >
        <div
          class="overflow-hidden text-ellipsis whitespace-nowrap text-sm font-semibold"
        >
          {{ displayName() }}
        </div>
        <div
          class="text-xs text-ui-fg-subtle overflow-hidden text-ellipsis whitespace-nowrap"
        >
          {{ auth.me()?.email }}
        </div>
      </div>
    </div>

    <p-divider styleClass="my-2" />

    <a
      class="flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
      [routerLink]="'/settings/profile'"
    >
      <i class="pi pi-user text-ui-fg-subtle me-2"></i>
      <span class="text-sm">Profile Settings</span>
    </a>

    <p-divider styleClass="my-2" />

    <a
      class="flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
      href="https://docs.medusajs.com"
      target="_blank"
      rel="noreferrer"
    >
      <i class="pi pi-book text-ui-fg-subtle me-2"></i>
      <span class="text-sm">Documentation</span>
    </a>

    <a
      class="flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
      href="https://medusajs.com/changelog/"
      target="_blank"
      rel="noreferrer"
    >
      <i class="pi pi-clock text-ui-fg-subtle me-2"></i>
      <span class="text-sm">Changelog</span>
    </a>

    <p-divider styleClass="my-2" />

    <button
      type="button"
      class="w-full text-left flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
      (click)="menuPanel.hide(); openShortcuts()"
    >
      <i class="pi pi-keyboard text-ui-fg-subtle me-2"></i>
      <span class="text-sm">Shortcuts</span>
    </button>

    <div class="mt-1">
      <div class="px-2 py-1 text-xs text-ui-fg-muted">Theme</div>

      <button
        type="button"
        class="w-full text-left flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
        (click)="setTheme('system')"
      >
        <i
          class="pi me-2"
          [class.pi-check]="isTheme('system')"
          [class.pi-circle]="!isTheme('system')"
        ></i>
        <span class="text-sm">System</span>
      </button>

      <button
        type="button"
        class="w-full text-left flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
        (click)="setTheme('light')"
      >
        <i
          class="pi me-2"
          [class.pi-check]="isTheme('light')"
          [class.pi-circle]="!isTheme('light')"
        ></i>
        <span class="text-sm">Light</span>
      </button>

      <button
        type="button"
        class="w-full text-left flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
        (click)="setTheme('dark')"
      >
        <i
          class="pi me-2"
          [class.pi-check]="isTheme('dark')"
          [class.pi-circle]="!isTheme('dark')"
        ></i>
        <span class="text-sm">Dark</span>
      </button>
    </div>

    <p-divider styleClass="my-2" />

    <button
      type="button"
      class="w-full text-left flex items-center rounded-md px-2 py-2 hover:bg-ui-bg-subtle-hover"
      (click)="logout()"
    >
      <i class="pi pi-sign-out text-ui-fg-subtle me-2"></i>
      <span class="text-sm">Logout</span>
    </button>
  </p-popover>

  <button
    type="button"
    class="bg-ui-bg-subtle grid w-full cursor-pointer grid-cols-[24px_1fr_15px] items-center gap-2 rounded-md py-1 ps-0.5 pe-2 outline-none hover:bg-ui-bg-subtle-hover focus-visible:shadow-borders-focus"
    (click)="menuPanel.toggle($event)"
  >
    <div
      class="flex size-6 items-center justify-center rounded-full bg-ui-bg-base"
    >
      <span class="text-xs font-semibold">{{ fallback() }}</span>
    </div>

    <div class="flex items-center overflow-hidden">
      <span class="truncate text-xs font-semibold">{{ displayName() }}</span>
    </div>

    <i class="pi pi-ellipsis-h text-ui-fg-muted"></i>
  </button>
</div>

<p-dialog
  [visible]="shortcutsOpen()"
  (visibleChange)="shortcutsOpen.set($event)"
  [modal]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '560px', maxWidth: 'calc(100vw - 24px)' }"
  styleClass="!overflow-hidden"
>
  <ng-template pTemplate="header">
    <div class="flex w-full items-center justify-between">
      <div class="text-base font-semibold">Shortcuts</div>
      <div class="flex items-center gap-x-2">
        <span class="px-2 py-1 rounded border text-xs">esc</span>
        <button
          pButton
          type="button"
          class="p-button-text p-button-sm"
          icon="pi pi-times"
          (click)="closeShortcuts()"
        >
          x
        </button>
      </div>
    </div>
  </ng-template>

  <div class="flex flex-col gap-y-3 px-1 py-2">
    <input
      pInputText
      type="search"
      [(ngModel)]="searchValue"
      class="w-full"
      placeholder="Search shortcutsâ€¦"
    />
  </div>

  <div class="flex flex-col divide-y overflow-y-auto -mx-6 px-6">
    <div
      *ngFor="let s of filteredShortcuts()"
      class="text-ui-fg-subtle flex items-center justify-between py-3"
    >
      <div class="text-sm">{{ s.label }}</div>

      <div class="flex items-center gap-x-1">
        <ng-container *ngFor="let k of s.keys.Mac; let j = index">
          <span class="px-2 py-1 rounded border text-xs">{{ k }}</span>
          <span
            *ngIf="j < (s.keys.Mac?.length || 0) - 1"
            class="text-xs text-ui-fg-subtle"
            >then</span
          >
        </ng-container>
      </div>
    </div>
  </div>
</p-dialog>

<!-- NavigationBar loading progress (fixed top) -->
<div class="fixed inset-x-0 top-0 z-50 h-1">
  @if (loading()) {
    <p-progressBar mode="indeterminate" [style]="{ height: '4px' }" />
  }
</div>

<div class="relative flex h-screen flex-col items-start overflow-hidden lg:flex-row">
  <div>
    <p-dialog
      [visible]="sidebar.mobileOpen()"
      (visibleChange)="sidebar.setMobile($event)"
      [modal]="true"
      [dismissableMask]="true"
      [draggable]="false"
      [resizable]="false"
      [closable]="false"
      [style]="{ width: '304px', maxWidth: '304px' }"
      [contentStyle]="{ padding: '0' }"
      styleClass="!m-0 !p-0"
      position="left"
    >
      <ng-template pTemplate="header">
        <div class="w-full p-3">
          <button
            pButton
            type="button"
            class="p-button-text p-button-sm"
            icon="pi pi-times"
            aria-label="Close navigation"
            (click)="closeMobile()"
          ></button>
          <span class="sr-only">Navigation</span>
        </div>
      </ng-template>

      <ng-content select="[sidebar]"></ng-content>

    </p-dialog>

    @if (sidebar.desktopOpen()) {
      <div class="hidden h-screen w-[220px] border-e lg:flex">
        <ng-content select="[sidebar]"></ng-content>

      </div>
    }
  </div>

  <div class="flex h-screen w-full flex-col overflow-auto">
    <div class="grid w-full grid-cols-2 border-b p-3">
      <div class="flex items-center gap-x-1.5">
        <div>
          <button
            pButton
            type="button"
            class="hidden p-button-text p-button-sm lg:flex"
            icon="pi pi-bars"
            aria-label="Toggle navigation"
            (click)="toggleDesktop()"
          ></button>

          <button
            pButton
            type="button"
            class="flex p-button-text p-button-sm lg:hidden"
            icon="pi pi-bars"
            aria-label="Open navigation"
            (click)="toggleMobile()"
          ></button>
        </div>

        <ol class="text-ui-fg-muted txt-compact-small-plus flex select-none items-center">
          <ng-container *ngFor="let c of breadcrumbs.crumbs(); let i = index">
            <li class="flex items-center">
              @if (i < breadcrumbs.crumbs().length - 1) {
                <a class="transition-fg hover:text-ui-fg-subtle" [routerLink]="c.path">
                  {{ c.label }}
                </a>
              } @else {
                <div>
                  @if (breadcrumbs.crumbs().length > 1) {
                    <span class="block lg:hidden"> ... </span>
                  }
                  <span
                    class="lg:block"
                    [class.hidden]="breadcrumbs.crumbs().length > 1"
                  >
                    {{ c.label }}
                  </span>
                </div>
              }

              @if (i < breadcrumbs.crumbs().length - 1) {
                <span class="mx-2">
                  <i class="pi pi-angle-right rtl:rotate-180"></i>
                </span>
              }
            </li>
          </ng-container>
        </ol>
      </div>

      <div class="flex items-center justify-end gap-x-3">
        <app-notifications />
      </div>
    </div>

    <main
      class="flex h-full w-full flex-col items-center overflow-y-auto transition-opacity delay-200 duration-200"
      [class.opacity-25]="loading()"
    >
      <div class="flex w-full max-w-[1600px] flex-col gap-y-2 p-3">
        <router-outlet />
      </div>
    </main>
  </div>
</div>
